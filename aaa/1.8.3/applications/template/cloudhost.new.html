<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" style="height: 100%;border: none;padding: 0px;margin: 0px;">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
	<meta http-equiv="X-UA-Compatible" content="IE=10; IE=9; IE=8; IE=7;  IE=EDGE"/>
	<meta content="Job Center" name="keywords" />
	<meta content="Job Center" name="description" />
	<meta name="generator" content="Job Center"/>
	<title>Cloud Host-Malakas</title>
	<link rel="stylesheet" href="/static/js/model/bootstrap-3.3.1-dist/dist/css/bootstrap.min.css" type="text/css"/>
	<link rel="stylesheet" href="/static/js/model/bootstrap-3.3.1-dist/dist/css/bootstrap-theme.min.css" type="text/css"/>
	<!--<link rel="stylesheet" href="/static/js/model/DataTables-1.10.4-trial/media/css/jquery.dataTables.css" type="text/css"/>
	<link rel="stylesheet" href="/static/js/model/DataTables-1.10.4-trial/extensions/TableTools/css/dataTables.tableTools.min.css" type="text/css"/>
	<link rel="stylesheet" href="/static/js/model/DataTables-1.10.4-trial/extensions/Editor-1.3.3/css/dataTables.editor.min.css" type="text/css"/>
	<link rel="stylesheet" href="/static/js/model/bootstrap-3.3.1-dist/dist/css/font-awesome.css" type="text/css"/>
	<link rel="stylesheet" href="/static/css/demo/nav/docs.min.css" type="text/css"/>-->
	<link rel="stylesheet" href="/static/js/model/bootstrap-datetimepicker-master/build/css/bootstrap-datetimepicker.min.css" type="text/css"/>
	<link rel="stylesheet" href="/static/js/model/bootstrap-table-master/dist/bootstrap-table.min.css" type="text/css"/>
	<style type="text/css">
		/* Move down content because we have a fixed navbar that is 50px tall */
		body {
			padding-top: 50px;
			padding-bottom: 20px;
		}
		
		/* item img opacity */
		.item img {
			opacity:0.8;
			filter:alpha(opacity=80); /* 针对 IE8 以及更早的版本 */
		}
		
		/* footer css #f8f8f8; */
		.pb-page-footer{
			width: 100%;
			color: gray;
			background-color: #3C3C3C;
			#border-top: 1px solid #e7e7e7;
			margin-top: 5px;
			margin-bottom: 0px;
			padding-top: 30px;
			padding-bottom: 30px;
		}
		.pb-page-footer a, .pb-page-footer a:visited {
			color: #777;
			text-decoration: none;
		}
		.pb-page-footer a:active, .pb-page-footer a:hover, .pb-page-footer a:focus{
			color: white;
			text-decoration: none;
		}
		body {
			padding-bottom:0px;
		}
		.pb-page-footer h4 {
			color:white;
		}
		
		/* job center body */
		.form-control {
			height: 34px;
		}
		.keep-open {
			height: 28px;
		}
		div.bootstrap-table > div.fixed-table-toolbar > div.columns.columns-right.btn-group.pull-right > div > button {
			height: 28px;
		}
		div.fixed-table-pagination > div.pull-left.pagination-detail > span.page-list {
			display: inline-block !important;
		}
		div.fixed-table-container > div.fixed-table-pagination > div.pull-right.pagination {
			display: inline-block !important;
		}
		.fixed-table-container {
			border: none;
		}
		
		.stepwizard-step p {
			margin-top: 10px;
		}

		.stepwizard-row {
			display: table-row;
		}

		.stepwizard {
			display: table;
			width: 100%;
			position: relative;
		}

		.stepwizard-step button[disabled] {
			opacity: 1 !important;
			filter: alpha(opacity=100) !important;
		}

		.stepwizard-row:before {
			top: 14px;
			bottom: 0;
			position: absolute;
			content: " ";
			width: 100%;
			height: 1px;
			background-color: #ccc;
			z-order: 0;

		}

		.stepwizard-step {
			display: table-cell;
			text-align: center;
			position: relative;
		}

		.btn-circle {
		  width: 30px;
		  height: 30px;
		  text-align: center;
		  padding: 6px 0;
		  font-size: 12px;
		  line-height: 1.428571429;
		  border-radius: 15px;
		}
	</style>
</head>
<body>
	<div id="id_header" style="width:100%;"></div>
	<div class="container-fluid" style='min-height:730px;'>
		<div class="container" style="margin-top:50px;">
			<h4 class="page-header" style="margin-top:10px;">New Instance</h4>
			<div class="stepwizard">
				<div class="stepwizard-row setup-panel">
					<div class="stepwizard-step">
						<a href="#step-1" type="button" class="btn btn-primary btn-circle">1</a>
						<p>Step 1</p>
					</div>
					<div class="stepwizard-step">
						<a href="#step-2" type="button" class="btn btn-default btn-circle" disabled="disabled">2</a>
						<p>Step 2</p>
					</div>
					<div class="stepwizard-step">
						<a href="#step-3" type="button" class="btn btn-default btn-circle" disabled="disabled">3</a>
						<p>Step 3</p>
					</div>
				</div>
			</div>
			<form role="form">
				<div class="row setup-content" id="step-1">
					<div class="col-xs-12">
						<div class="col-md-12">
							<h3> Step 1</h3>
							<div class="form-group">
								<label class="control-label">* Name</label>
								<input  id="id_Name" maxlength="100" type="text" required="required" class="form-control" value="Enter VM Name, eg: test_vm_01">
							</div>
							<!-- <div class="form-group">
								<label class="control-label">* JobName</label>&nbsp;&nbsp;<a href="/help/#id_createjob_basic" style="vertical-align: middle;">Help ?</a>
								<input id="id_job_name" maxlength="100" type="text" required="required" class="form-control" placeholder="Enter Job Name, eg: JobName" />
							</div> -->
					
							<button class="btn btn-primary nextBtn pull-right" type="button" style="margin-left:10px">Next</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
							<button class="btn btn-primary nextBtn pull-right" type="button" onclick="javascript:window.location.href='/cloudhost/'">Cancel</button>
						</div>
					</div>
				</div>
				<div class="row setup-content" id="step-2">
					<div class="col-xs-12">
						<div class="col-md-12">
							<h3> Step 2</h3>
							<div class="form-group">
								<label class="control-label">* Availability_Zone</label>
								<input id="id_Availability_Zone" maxlength="200" type="text" required="required" class="form-control" value="Enter Availability_Zone, eg: nova" />
							</div>
							<div class="form-group">
								<label class="control-label">FlavorRef</label>
								<input id="id_FlavorRef" maxlength="2000" type="text" class="form-control" value="Enter FlavorRef, eg: 1969c489-8a27-4205-970b-a4885467a280"  />
							</div>
							<div class="form-group">
								<label class="control-label">* ImageRef</label>
								<input id="id_ImageRef" maxlength="2000" type="text" required="required" class="form-control" value="Enter ImageRef, eg: db3fbb35-23c8-44de-9bd6-645b267c4375"  />
							</div>
							<!-- <div class="form-group">
								<label class="control-label">Key_Name</label>&nbsp;&nbsp;<a href="/help/#id_createjob_basic" style="vertical-align: middle;">Help ?</a>
								<input id="id_forks" maxlength="200" type="text" class="form-control" value="Enter Forks Number, eg: 5"  />
							</div> -->
                            <div class="form-group">
								<label class="control-label">Security_Groups</label>
								<input id="id_Security_Groups" maxlength="200" type="text" class="form-control" value="Enter Security_Groups, eg: web"  />
							</div>
							
							<button class="btn btn-primary nextBtn pull-right" type="button" style="margin-left:10px">Next</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
							<button class="btn btn-primary nextBtn pull-right" type="button" onclick="javascript:window.location.href='/cloudhost/'">Cancel</button>
						</div>
					</div>
				</div>
				<div class="row setup-content" id="step-3">
					<div class="col-xs-12">
						<div class="col-md-12">
							<h3> Step 3</h3>
							
							<button class="btn btn-success pull-right" type="submit" style="margin-left:10px" onclick="return submitNewVM();">Submit!</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
							<button class="btn btn-primary nextBtn pull-right" type="button" onclick="javascript:window.location.href='/cloudhost/'">Cancel</button>
							<div id="id_loading" style="display:none;">
								<p style="text-align:center;"><img src="/static/images/loading.gif"></img></p>
								<p style="text-align:center;">Submitting，Please wait a moment...</p>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
	
	<div id="id_footer" style="width:100%;"></div>
	
	
	<!-- Modal -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>-->
					<h4 class="modal-title" id="myModalLabel">Info</h4>
				</div>
				<div class="modal-body text-center">
					Operation Success
				</div>
				<!--<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary">Save changes</button>
				</div>-->
			</div>
		</div>
	</div>
	<!-- Alert -->
	<div id="alerts" style='position:fixed;top:60px;right:20px;'></div>
	
	<script src="/static/js/jquery-1.11.2.min.js"></script>
	<script src="/static/js/model/bootstrap-3.3.1-dist/dist/js/bootstrap.min.js"></script>
	<!--<script src="/static/js/model/bootstrap-treeview-master/bootstrap-treeview-master/dist/bootstrap-treeview.min.js"></script>-->
	<script src="/static/js/model/Highcharts-4.0.4/js/highcharts.js"></script>
	<!--<script src="/static/js/model/DataTables-1.10.4-trial/media/js/jquery.dataTables.min.js"></script>
	<script src="/static/js/model/DataTables-1.10.4-trial/extensions/TableTools/js/dataTables.tableTools.min.js"></script>
	<script src="/static/js/model/DataTables-1.10.4-trial/extensions/Editor-1.3.3/js/dataTables.editor.min.js"></script>
	<script src="/static/js/model/jquery-validation-1.13.1/dist/jquery.validate.min.js"></script>-->
	<script src="/static/js/model/bootstrap-3.3.1-dist/dist/js/docs.min.js"></script>
	<script src="/static/js/model/moment-develop/min/moment-with-locales.min.js"></script>
	<script src="/static/js/model/bootstrap-datetimepicker-master/build/js/bootstrap-datetimepicker.min.js"></script>
	<script src="/static/js/model/bootstrap-table-master/dist/bootstrap-table.min.js"></script>
	<script src="/static/js/model/bootstrap-table-master/dist/locale/bootstrap-table-zh-CN.min.js"></script>
	<script type="text/javascript">
        //向导插件
		$(document).ready(function () {
			var navListItems = $('div.setup-panel div a'),
					allWells = $('.setup-content'),
					allNextBtn = $('.nextBtn');

			allWells.hide();

			navListItems.click(function (e) {
				e.preventDefault();
				var $target = $($(this).attr('href')),
						$item = $(this);

				if (!$item.hasClass('disabled')) {
					navListItems.removeClass('btn-primary').addClass('btn-default');
					$item.addClass('btn-primary');
					allWells.hide();
					$target.show();
					$target.find('input:eq(0)').focus();
				}
			});

			allNextBtn.click(function(){
				var curStep = $(this).closest(".setup-content"),
					curStepBtn = curStep.attr("id"),
					nextStepWizard = $('div.setup-panel div a[href="#' + curStepBtn + '"]').parent().next().children("a"),
					curInputs = curStep.find("input[type='text'],input[type='url']"),
					isValid = true;

				$(".form-group").removeClass("has-error");
				for(var i=0; i<curInputs.length; i++){
					if (!curInputs[i].validity.valid){
						isValid = false;
						$(curInputs[i]).closest(".form-group").addClass("has-error");
					}
				}

				if (isValid)
					nextStepWizard.removeAttr('disabled').trigger('click');
			});

			$('div.setup-panel div a.btn-primary').trigger('click');
		});
        
        $(document).ready(function(e) {
            var header_url = "/header/";
            var footer_url = "/footer/";
            $('#id_header').load(header_url, function(){
                    $("#id_menu_cloudhost").addClass("active");
                }
            );
            $('#id_footer').load(footer_url);
		});
        
		function parseRequestURL(paras) {
			var url = location.href;
			var paraString = url.substring(url.indexOf("?")+1,url.length).split("&"); 
			var paraObj = {} 
			for (i=0; j=paraString[i]; i++){ 
				paraObj[j.substring(0,j.indexOf("=")).toLowerCase()] = j.substring(j.indexOf("=")+1,j.length); 
			} 
			var returnValue = paraObj[paras.toLowerCase()]; 
			if(typeof(returnValue)=="undefined"){ 
				return ""; 
			}else{ 
				return returnValue; 
			} 
		}
		
		
		
		function showModal(){
			$('#myModal').modal('show');
		}
		function hideModal(){
			$('#myModal').modal('hide');
		}
		$(document).ready(function(){
			$('#myModal').on('shown.bs.modal', function() {
				// remove previous timeouts if it's opened more than once.
				//clearTimeout(myModalTimeout);
				myModalTimeout = setTimeout(function() {
					hideModal();
				}, 2000);
			});
		});
		function addAlert(message) {
			$('#alerts').append(
				'<div class="alert alert-danger alert-dismissible fade in" style="min-width:300px;">' +
					'<button type="button" class="close" data-dismiss="alert">' +
					'&times;</button>' + message + '</div>');
		}
		function submitJobBasic() {
			var request = {};
			request['job_type'] = 0;
			request['job_name'] = $('#id_job_name').val();
			request['module_name'] = $('#id_module_name').val();
			request['module_args'] = $('#id_module_args').val();
			request['pattern'] = $('#id_pattern').val();
			
			var forks = Number($('#id_forks').val());
			if (isNaN(forks)) {
				addAlert("ParamException: " + "forks should be Number.");
				return false;
			}
			
			if (forks < 0 || forks > 100) {
				addAlert("ParamException: " + "forks should be between 1 and 100.");
				return false;
			}
			
			if (forks == 0) {
				request['forks'] = 5;
			} else {
				request['forks'] = forks;
			}
			
			var submit = $('#id_job_submit').val();
			if (submit == "") {
				request['job_submit'] = "admin";
			} else {
				request['job_submit'] = submit;
			}
			//alert(JSON.stringify(request));
			$.when(submitJob(request)).done(function(data){
				if(data.ERRORCODE == 0) {
					//showModal();
					window.location.href = "/jobcenter/";
				} else {
					//showModal();
					addAlert(data.CH + " : " + data.msg);
				}
			});
			return false;
		}
		function newVMInstance(request) {
			var defer = $.Deferred();
			$.ajax({
				type: "POST",
				url : '/newVMInstance/',
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				data: JSON.stringify(request),
				//async : false,
				beforeSend:function(XMLHttpRequest){
				   document.getElementById('id_loading').style.display = "block";
				},
				success: function(data){
					//document.getElementById('id_loading').style.display = "block";
					defer.resolve(data)
				}
			});
			return defer.promise();
		}
        
        function submitNewVM() {
            var request = {};
			request['name'] = $('#id_Name').val();
			request['availability_zone'] = $('#id_Availability_Zone').val();
			request['flavorRef'] = $('#id_FlavorRef').val();
			request['imageRef'] = $('#id_ImageRef').val();
            request['security_groups'] = $('#id_Security_Groups').val();
			
			//alert(JSON.stringify(request));
			$.when(newVMInstance(request)).done(function(data){
				if(data.ERRORCODE == 0) {
					//showModal();
					window.location.href = "/cloudhost/";
				} else {
					//showModal();
					addAlert(data.CH + " : " + JSON.stringify(data.msg));
				}
			});
			return false;
        }
	</script>
    <style type="text/css">
		/* Move down content because we have a fixed navbar that is 50px tall */
		body {
			padding-top: 50px;
			padding-bottom: 20px;
		}
		
		/* item img opacity */
		.item img {
			opacity:0.8;
			filter:alpha(opacity=80); /* 针对 IE8 以及更早的版本 */
		}
		
		/* footer css #f8f8f8; */
		.pb-page-footer{
			width: 100%;
			color: gray;
			background-color: #3C3C3C;
			#border-top: 1px solid #e7e7e7;
			margin-top: 5px;
			margin-bottom: 0px;
			padding-top: 30px;
			padding-bottom: 30px;
		}
		.pb-page-footer a, .pb-page-footer a:visited {
			color: #777;
			text-decoration: none;
		}
		.pb-page-footer a:active, .pb-page-footer a:hover, .pb-page-footer a:focus{
			color: white;
			text-decoration: none;
		}
		body {
			padding-bottom:0px;
		}
		.pb-page-footer h4 {
			color:white;
		}
		
		/* job center body */
		.form-control {
			height: 34px;
		}
		.keep-open {
			height: 28px;
		}
		div.bootstrap-table > div.fixed-table-toolbar > div.columns.columns-right.btn-group.pull-right > div > button {
			height: 28px;
		}
		div.fixed-table-pagination > div.pull-left.pagination-detail > span.page-list {
			display: inline-block !important;
		}
		div.fixed-table-container > div.fixed-table-pagination > div.pull-right.pagination {
			display: inline-block !important;
		}
		.fixed-table-container {
			border: none;
		}
		
		.stepwizard-step p {
			margin-top: 10px;
		}

		.stepwizard-row {
			display: table-row;
		}

		.stepwizard {
			display: table;
			width: 100%;
			position: relative;
		}

		.stepwizard-step button[disabled] {
			opacity: 1 !important;
			filter: alpha(opacity=100) !important;
		}

		.stepwizard-row:before {
			top: 14px;
			bottom: 0;
			position: absolute;
			content: " ";
			width: 100%;
			height: 1px;
			background-color: #ccc;
			z-order: 0;

		}

		.stepwizard-step {
			display: table-cell;
			text-align: center;
			position: relative;
		}

		.btn-circle {
		  width: 30px;
		  height: 30px;
		  text-align: center;
		  padding: 6px 0;
		  font-size: 12px;
		  line-height: 1.428571429;
		  border-radius: 15px;
		}
	</style>
</body>
</html>
